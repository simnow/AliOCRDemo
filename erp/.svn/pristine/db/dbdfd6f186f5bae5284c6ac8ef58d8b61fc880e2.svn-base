<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.caecc.erp.modules.dao.ex.mapper.WorkingSummaryExMapper" >
  <resultMap id="BaseResultMap" type="cn.caecc.erp.modules.dao.ex.dto.WorkingSummaryDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 30 09:17:36 CST 2018.
    -->
    <id column="WorkingSummaryId" property="workingsummaryid" jdbcType="INTEGER" />
    <result column="UId" property="uid" jdbcType="INTEGER" />
    <result column="DId" property="did" jdbcType="INTEGER" />
    <result column="Week" property="week" jdbcType="TIMESTAMP" />
    <result column="Description" property="description" jdbcType="VARCHAR" />
    <result column="CreateUserId" property="createuserid" jdbcType="INTEGER" />
    <result column="CreateTime" property="createtime" jdbcType="TIMESTAMP" />
    <result column="UserName" property="username" jdbcType="VARCHAR" />
    <result column="DeptName" property="deptname" jdbcType="VARCHAR" />
    <result column="WeekNumber" property="weeknumber" jdbcType="INTEGER" />
    
  </resultMap>
  <select id="findByWeekAndDid" parameterType="cn.caecc.erp.modules.dao.mybatis.entity.WorkingSummary" resultMap="BaseResultMap">
  
  	SELECT WS.* FROM working_summary WS
  	
	WHERE YEARWEEK(WS.`Week`,1)=YEARWEEK(#{week},1)
	
	AND  WS.Did=#{did}
	
  </select>
  
  <select id="findlistByCondition" parameterType="hashmap" resultMap="BaseResultMap">
  
  			
	SELECT WS.WorkingSummaryId,WS.CreateTime,U.`Name` AS UserName,D.`Name` AS DeptName,WEEK(WS.`Week`,1) AS WeekNumber

	FROM working_summary WS 

	LEFT JOIN `user` U

	ON(WS.UId=U.Id)

	LEFT JOIN department D

	ON(WS.DId=D.Id)
	
	<where>	
		<if test="did!=null">
			AND WS.DId=#{did}
		</if>	
		<if test="nowsummary!=null">
			AND YEARWEEK(WS.`Week`,1)=YEARWEEK(NOW(),1)
		</if>	
		<if test="starttime!=null and endtime!=null">
			AND WS.`Week` BETWEEN  DATE_FORMAT(#{starttime},'%Y-%m-%d')   AND  #{endtime}
		</if>
		ORDER BY WS.`Week`
	</where>
	
  </select>
  
 <select id="findDtoById" parameterType="int" resultMap="BaseResultMap">
 	
	SELECT  WS.*,U.`Name` AS UserName,D.`Name` AS DeptName,WEEK(WS.`Week`,1) AS WeekNumber

	FROM working_summary WS 

	LEFT JOIN `user` U

	ON(WS.UId=U.Id)

	LEFT JOIN department D

	ON(WS.DId=D.Id)
	
	WHERE WS.WorkingSummaryId=#{id}
  
  </select>
</mapper>