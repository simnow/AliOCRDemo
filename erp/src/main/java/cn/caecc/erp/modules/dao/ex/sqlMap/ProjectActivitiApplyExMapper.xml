<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="cn.caecc.erp.modules.dao.ex.mapper.ProjectActivitiApplyExMapper">
	<resultMap id="projectActivitiApplyDto"
		type="cn.caecc.erp.modules.dao.ex.dto.ProjectActivitiApplyDto">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jun 12 
			10:09:34 CST 2018. -->
		<id column="Id" property="id" jdbcType="INTEGER" />
		<result column="Code" property="code" jdbcType="VARCHAR" />
		<result column="ProcessInstanceId" property="processinstanceid"
			jdbcType="VARCHAR" />
		<result column="DId" property="did" jdbcType="INTEGER" />
		<result column="UId" property="uid" jdbcType="INTEGER" />
		<result column="Name" property="name" jdbcType="VARCHAR" />
		<result column="Telephone" property="telephone" jdbcType="VARCHAR" />
		<result column="Relative" property="relative" jdbcType="VARCHAR" />
		<result column="Agent" property="agent" jdbcType="VARCHAR" />
		<result column="Telephone2" property="telephone2" jdbcType="VARCHAR" />
		<result column="Money" property="money" jdbcType="DOUBLE" />
		<result column="Situation" property="situation" jdbcType="VARCHAR" />
		<result column="CreateUserId" property="createuserid" jdbcType="INTEGER" />
		<result column="CreateTime" property="createtime" jdbcType="TIMESTAMP" />
		<result column="IsSuccess" property="issuccess" jdbcType="INTEGER" />
		<result column="dname" property="dname" jdbcType="VARCHAR" />
		<result column="uname" property="uname" jdbcType="VARCHAR" />
		<result column="sname" property="sname" jdbcType="VARCHAR" />
		<result column="cname" property="cname" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jun 12 
			10:09:34 CST 2018. -->
		Id, Code, ProcessInstanceId, DId, UId, Name, Telephone,
		Relative,
		Agent,
		Telephone2, Money, Situation, CreateUserId,
		CreateTime, IsSuccess
	</sql>
	<!-- 按条件查询立项分页列表 -->
	<select id="getList" resultMap="projectActivitiApplyDto">
		select p.*,d.name dname,u.name uname,c.name cname
		from
		project_activiti_apply p
		left join department d
		on(p.did=d.id)
		left join
		user u
		on(p.uid=u.id)
		left join user c
		on(p.createuserid=c.id)
		<where>
			<if test="isSuccess != null">
				p.isSuccess = #{isSuccess}
			</if>
			<if test="userid != null">
				and p.createuserid = #{userid}
			</if>
			<if test="drafts == 'drafts'">
				and p.processinstanceid is null
			</if>
			<if test="name != null and name != ''">
				and p.name LIKE CONCAT(CONCAT('%',REPLACE(#{name},' ',''),'%'))
			</if>
		</where>
	</select>

	<!-- 查询立项申请详情 -->
	<select id="findDetail" parameterType="int" resultMap="projectActivitiApplyDto">
		select p.*,d.name dname,u.name uname,c.name cname
		from
		project_activiti_apply p
		left join department d
		on(p.did=d.id)
		left join
		user u
		on(p.uid=u.id)
		left join user c
		on(p.createuserid=c.id)
		<where>
			p.id = #{id}
		</where>
	</select>
</mapper>